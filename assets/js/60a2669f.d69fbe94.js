"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[845],{7410:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var s=t(4848),i=t(8453);const r={sidebar_position:9},o="\u4e2d\u95f4\u4ef6",a={id:"b-next/middleware",title:"\u4e2d\u95f4\u4ef6",description:"\u4e2d\u95f4\u4ef6\u662f\u6709\u522b\u4e8e\u5927\u578b\u5e94\u7528\u7684\uff0c\u662f\u5168\u5c40\u751f\u6548\u7684\uff0c\u53ef\u6269\u5c55\u5b57\u6bb5\u7684\u811a\u672c",source:"@site/docs/b-next/9-middleware.md",sourceDirName:"b-next",slug:"/b-next/middleware",permalink:"/docs/docs/b-next/middleware",draft:!1,unlisted:!1,editUrl:"https://github.com/yunzai-org/docs/tree/main/docs/b-next/9-middleware.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"\u914d\u7f6e",permalink:"/docs/docs/b-next/config"},next:{title:"MYS-DOCS",permalink:"/docs/docs/category/mys-docs"}},d={},c=[];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"\u4e2d\u95f4\u4ef6",children:"\u4e2d\u95f4\u4ef6"}),"\n",(0,s.jsx)(n.admonition,{title:"\u63d0\u793a",type:"tip",children:(0,s.jsx)(n.p,{children:"\u4e2d\u95f4\u4ef6\u662f\u6709\u522b\u4e8e\u5927\u578b\u5e94\u7528\u7684\uff0c\u662f\u5168\u5c40\u751f\u6548\u7684\uff0c\u53ef\u6269\u5c55\u5b57\u6bb5\u7684\u811a\u672c"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7f16\u5199"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="./middleware/message/star-rail.ts"',children:"import { middlewareOptions, useEvent } from 'yunzai'\n// \u5e38\u91cf\nconst srReg = /^#?(\\*|\u661f\u94c1|\u661f\u8f68|\u7a79\u8f68|\u661f\u7a79|\u5d29\u94c1|\u661f\u7a79\u94c1\u9053|\u5d29\u574f\u661f\u7a79\u94c1\u9053|\u94c1\u9053)+/\n// \u7528\u6237\u53ef\u4e2a\u6027\u5316\u7684\u914d\u7f6e\ntype options = { name: string }\nexport default (config?: options) => {\n  // \u8fd4\u56de\u4e2d\u95f4\u4ef6\n  return middlewareOptions({\n    // \u7c7b\u578b\n    typing: 'message',\n    // \u63d2\u4ef6\u540d\n    name: config?.name ?? 'StarRail',\n    //\n    on: event => {\n      // \u8981\u4f7f\u7528\u4e00\u4e2a\u590d\u6742\u7c7b\u578b\u7684 event \u9700\u8981 \u4f7f\u7528 useEvent\n      useEvent(\n        e => {\n          Object.defineProperty(e, 'isSr', {\n            get: () => e.game === 'sr',\n            set: v => (e.game = v ? 'sr' : 'gs')\n          })\n          Object.defineProperty(e, 'isGs', {\n            get: () => e.game === 'gs',\n            set: v => (e.game = v ? 'gs' : 'sr')\n          })\n          if (srReg.test(e.msg)) {\n            // \u8bbe\u7f6e\u4e3a\u661f\u94c1\n            e.game = 'sr'\n          }\n          // \u53d1\u73b0\u661f\u94c1\u6d88\u606f\n          if (srReg.test(e.msg)) {\n            // \u91cd\u7f6e\u6d88\u606f -- \u8fd9\u662f\u55b5\u55b5\u63d2\u4ef6\u5185 \u6b63\u786e\u7684\u5339\u914d\u89c4\u5219 \u5373\u53ef  #\u661f\u94c1\u7ed1\u5b9auid\n            e.msg = e.msg.replace(srReg, '#\u661f\u94c1')\n          }\n        }, // \u8f93\u5165\u4e8b\u4ef6 \u5e76\u9009\u62e9 \u6267\u884c\u7684\u7c7b\u578b\n        [event, 'message.group', 'message.private']\n      )\n      //\n    }\n  })\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u914d\u7f6e"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="yunzai.config.js"',children:"import { defineConfig } from 'yunzai'\nimport starRail from 'yz-mw-star-rail'\nexport default defineConfig({\n  // \u4e2d\u95f4\u4ef6\n  middlewares: [starRail()]\n})\n"})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);